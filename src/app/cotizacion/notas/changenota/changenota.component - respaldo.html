<!-- <p>changenota works!</p> -->
<h2 mat-dialog-title>Descripción de Cotización</h2>
<form [formGroup]="form" (ngSubmit)="submit()">
  <mat-form-field appearance="fill" class="w-100">
    <mat-label>Cliente</mat-label>
    <input matInput formControlName="cliente">
  </mat-form-field>

  <mat-form-field appearance="fill" class="w-100">
    <mat-label>RFC</mat-label>
    <input matInput formControlName="rfc">
  </mat-form-field>

  <!-- Selector de Producto -->
  <div class="row">
    <mat-form-field appearance="fill" class="col-4">
      <mat-label>Producto</mat-label>
      <mat-select formControlName="productoSeleccionado" (selectionChange)="seleccionarProducto($event.value)">
        <mat-option *ngFor="let prod of productos" [value]="prod.int_id_prod_service">
          {{ prod.vch_nombre_prod_service }}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="fill" class="col-3">
      <mat-label>Cantidad</mat-label>
      <input matInput type="number" formControlName="cantidadSeleccionada">
    </mat-form-field>

    <div class="col-3" *ngIf="selectedProduct">
      <p>Precio: {{ selectedProduct.precio | currency }}</p>
    </div>

    <div class="col-2">
      <button mat-raised-button color="primary" type="button" (click)="agregarFila()">Agregar</button>
    </div>
  </div>

  <!-- Tabla -->
  <table mat-table [dataSource]="items.controls" class="mat-elevation-z8" formArrayName="items">

    <!-- Producto -->
    <ng-container matColumnDef="producto">
      <th mat-header-cell *matHeaderCellDef>Producto</th>
      <td mat-cell *matCellDef="let row; let i = index" [formGroupName]="i">
        {{ row.value.productoNombre }}
      </td>
    </ng-container>

    <!-- Precio -->
    <ng-container matColumnDef="precio">
      <th mat-header-cell *matHeaderCellDef>Precio</th>
      <td mat-cell *matCellDef="let row; let i = index" [formGroupName]="i">
        {{ row.value.precio | currency }}
      </td>
    </ng-container>

    <!-- Cantidad -->
    <ng-container matColumnDef="cantidad">
      <th mat-header-cell *matHeaderCellDef>Cantidad</th>
      <td mat-cell *matCellDef="let row; let i = index" [formGroupName]="i">
        <mat-form-field appearance="fill">
          <input matInput type="number" formControlName="cantidad">
        </mat-form-field>
      </td>
    </ng-container>

    <!-- Acciones -->
    <ng-container matColumnDef="acciones">
      <th mat-header-cell *matHeaderCellDef>Acciones</th>
      <td mat-cell *matCellDef="let row; let i = index">
        <button mat-icon-button color="warn" (click)="eliminarFila(i)">
          <mat-icon>delete</mat-icon>
        </button>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="['producto', 'precio', 'cantidad', 'acciones']"></tr>
    <tr mat-row *matRowDef="let row; columns: ['producto', 'precio', 'cantidad', 'acciones'];"></tr>
  </table>

  <!-- <button mat-raised-button color="accent" type="submit">Guardar</button> -->
</form>

<mat-dialog-actions align="end">
  <button mat-button class="btn btn-primary mr-2" [disabled]="!form.valid" (click)="accionEditar()">Guardar</button>
  <button mat-button class="btn" (click)="close()">Cerrar</button>
</mat-dialog-actions>
